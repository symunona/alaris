(function(){"use strict";var qe=document.createElement("style");qe.textContent=`#weeks{padding:12px}.weeks-grid{display:grid;grid-auto-rows:min-content;gap:6px}.decade-group{display:grid;gap:6px;padding:6px 0 10px;border-bottom:1px solid #e5e7eb}.decade-header{font-weight:600;color:#374151;font-size:12px;letter-spacing:.02em}.weeks-header{display:grid;grid-template-columns:40px repeat(52,16px);gap:4px;align-items:end}.year-head-spacer{width:40px}.week-head{width:16px;font-size:9px;color:#6b7280;text-align:center;line-height:1}.year-row{display:grid;grid-template-columns:40px repeat(52,16px) 40px;gap:4px;align-items:center;position:relative}.year-edge{width:40px;height:16px;border-radius:4px}.year-row:before{content:none}.year-head{width:40px;font-size:11px;color:#4b5563;text-align:right;padding-right:4px}.week-box{width:16px;height:16px;background:transparent;border:1px solid #cbd5e1;border-radius:0;box-shadow:none}.week-box:hover{border-color:#5b9bd5;outline:none}.week-box.before-my-time{background:transparent;border-color:#f8f9fb!important}.week-box.before-my-time:hover{outline:none}.week-box.future{opacity:.2}.week-box.selected{outline:2px solid #2563eb;background:#dbeafe}.week-box.filled{background:#76bde9;border-color:#60a5fa;position:relative}.week-box.season-winter{border-color:#9ca3af}.week-box.season-spring{border-color:#86efac}.week-box.season-summer{border-color:#fbbf24}.week-box.season-autumn{border-color:#ef4444}.week-box.season-winter:hover{border-color:#4b5563}.week-box.season-spring:hover{border-color:#16a34a}.week-box.season-summer:hover{border-color:#a16207}.week-box.season-autumn:hover{border-color:#b91c1c}.tag-bars{display:grid;grid-template-columns:40px 1fr 40px;gap:4px;margin:4px 0 10px}.tag-edge{width:40px;border-radius:4px}.tag-lines{display:flex;flex-direction:column;gap:2px;position:relative;--week: 16px;--gap: 4px;background-image:none;border-radius:4px}.tag-row{position:relative;height:16px;width:calc(52 * var(--week) + (52 - 1) * var(--gap))}.tag-cell{width:16px;height:16px;border:1px solid transparent;border-radius:0;position:relative;overflow:hidden}.tag-span{position:absolute;top:0;left:var(--left, calc(var(--x) * (var(--week) + var(--gap))));width:var(--width, calc(var(--w) * var(--week) + (var(--w) - 1) * var(--gap)));height:16px;border:1px solid transparent;border-radius:2px}.tag-span.edited{box-shadow:0 0 0 2px #22c55e inset,0 0 0 1px #16a34a;border-color:#16a34a!important}.tag-label{position:absolute;left:2px;right:2px;top:0;bottom:0;font-size:9px;line-height:16px;color:#111827;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;pointer-events:none}.tag-hover{display:none;position:absolute;left:0;top:18px;z-index:20;max-width:300px;width:max-content;background:#ffffff;border:1px solid #e5e7eb;border-radius:6px;box-shadow:0 10px 20px #00000014,0 6px 6px #0000000f;padding:8px}.tag-span:hover .tag-hover{display:block}.tag-hover-fields{display:grid;grid-template-columns:1fr;gap:6px}.tag-hover-fields label{display:grid;gap:2px;font-size:11px;color:#374151}.tag-hover-fields input,.tag-hover-fields textarea{width:100%;box-sizing:border-box;padding:6px 8px;border:1px solid #d1d5db;border-radius:4px;background:#f9fafb;color:#111827;font-size:12px}.tag-hover-fields textarea{resize:vertical}.tag-hover-image{margin-top:8px;border:1px solid #e5e7eb;border-radius:4px;overflow:hidden}.tag-hover-image img{display:block;width:100%;height:auto}.event-hover{display:none;position:absolute;left:0;top:18px;z-index:20;max-width:280px;width:max-content;background:#ffffff;border:1px solid #e5e7eb;border-radius:6px;box-shadow:0 10px 20px #00000014,0 6px 6px #0000000f;padding:8px}.week-box:hover .event-hover{display:block}.event-hover-title{font-weight:600;font-size:12px;margin-bottom:6px;color:#111827}.event-hover-list{margin:0;padding:0;list-style:none;display:grid;gap:4px}.event-hover-list li{font-size:12px;color:#374151;cursor:pointer}.event-hover-list li .event-item-link{display:block;color:inherit;text-decoration:none}.event-hover-list li .event-item-link:hover{text-decoration:underline}.event-date{color:#6b7280;margin-right:6px}.event-name{color:#111827;font-weight:500}.event-desc{font-size:11px;color:#4b5563}.event-more{margin-top:6px;font-size:11px;color:#6b7280}.week-event-tooltip{position:fixed;z-index:99999;transform:translateY(6px);pointer-events:auto}.week-event-tooltip .event-hover{display:block!important;position:static;pointer-events:auto}.events-track{display:grid;grid-template-columns:40px 1fr 40px;gap:4px;margin:2px 0 8px}.events-pins{position:relative;--week: 16px;--gap: 4px;height:18px;width:calc(52 * var(--week) + (52 - 1) * var(--gap))}.event-pin{position:absolute;left:calc((var(--x) - 1) * (var(--week) + var(--gap)));top:0;display:flex;align-items:flex-end}.event-pin .stem{display:inline-block;width:2px;height:12px;background:#9ca3af;position:relative}.event-pin .stem:after{content:"";position:absolute;left:50%;bottom:-2px;width:6px;height:6px;background:#374151;border-radius:9999px;transform:translate(-50%)}.event-pin .elabel{margin-left:6px;font-size:12px;color:#111827;white-space:nowrap;line-height:1}.tag-detail{display:grid;gap:12px;padding:0 12px 12px;position:relative}.back-btn{width:max-content;padding:6px 10px;font-size:12px;background:#f3f4f6;border:1px solid #e5e7eb;border-radius:4px;cursor:pointer}.back-btn:hover{background:#e5e7eb}.tag-title{margin:0;font-size:20px;font-weight:600;color:#111827}.tag-image-wrap{width:100%;max-height:calc(100vh - 180px);overflow:hidden;border-radius:8px;border:1px solid #e5e7eb;background:#f9fafb}.tag-image-wrap.placeholder{display:grid;place-items:center;color:#6b7280;height:240px}.tag-image{display:block;width:100%;height:100%;object-fit:cover}.tag-form{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;align-items:end}.tag-form label{display:grid;gap:4px;font-size:12px;color:#374151}.tag-form input{height:34px;padding:6px 8px;border:1px solid #d1d5db;border-radius:6px;background:#f9fafb;color:#111827}.tag-form input[readonly]{background:#f3f4f6}.tag-actions{display:flex;gap:8px;position:absolute;top:12px;right:12px;white-space:nowrap}.tag-actions>*{flex:0 0 auto}.save-btn{background:#2563eb;border:1px solid #1d4ed8;color:#fff;padding:6px 10px;border-radius:4px;cursor:pointer}.save-btn:hover{background:#1d4ed8}.delete-btn{background:#fee2e2;border:1px solid #fecaca;color:#991b1b;padding:6px 10px;border-radius:4px;cursor:pointer}.delete-btn:hover{background:#fecaca}
`,document.head.appendChild(qe);const $t=!1,yt=(t,e)=>t===e,kt=Symbol("solid-track"),_e={equals:yt};let Ge=et;const ie=1,De=2,Je={owned:null,cleanups:null,context:null,owner:null};var O=null;let Ue=null,St=null,B=null,j=null,ee=null,Te=0;function Ce(t,e){const n=B,s=O,a=t.length===0,i=e===void 0?s:e,o=a?Je:{owned:null,cleanups:null,context:i?i.context:null,owner:i},r=a?t:()=>t(()=>ae(()=>we(o)));O=o,B=null;try{return xe(r,!0)}finally{B=n,O=s}}function Y(t,e){e=e?Object.assign({},_e,e):_e;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},s=a=>(typeof a=="function"&&(a=a(n.value)),Ze(n,a));return[Qe.bind(n),s]}function E(t,e,n){const s=ze(t,e,!1,ie);me(s)}function Xe(t,e,n){Ge=Et;const s=ze(t,e,!1,ie);(!n||!n.render)&&(s.user=!0),ee?ee.push(s):me(s)}function H(t,e,n){n=n?Object.assign({},_e,n):_e;const s=ze(t,e,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=n.equals||void 0,me(s),Qe.bind(s)}function ae(t){if(B===null)return t();const e=B;B=null;try{return t()}finally{B=e}}function _t(t){Xe(()=>ae(t))}function Dt(t){return O===null||(O.cleanups===null?O.cleanups=[t]:O.cleanups.push(t)),t}function Qe(){if(this.sources&&this.state)if(this.state===ie)me(this);else{const t=j;j=null,xe(()=>Ie(this),!1),j=t}if(B){const t=this.observers?this.observers.length:0;B.sources?(B.sources.push(this),B.sourceSlots.push(t)):(B.sources=[this],B.sourceSlots=[t]),this.observers?(this.observers.push(B),this.observerSlots.push(B.sources.length-1)):(this.observers=[B],this.observerSlots=[B.sources.length-1])}return this.value}function Ze(t,e,n){let s=t.value;return(!t.comparator||!t.comparator(s,e))&&(t.value=e,t.observers&&t.observers.length&&xe(()=>{for(let a=0;a<t.observers.length;a+=1){const i=t.observers[a],o=Ue&&Ue.running;o&&Ue.disposed.has(i),(o?!i.tState:!i.state)&&(i.pure?j.push(i):ee.push(i),i.observers&&tt(i)),o||(i.state=ie)}if(j.length>1e6)throw j=[],new Error},!1)),e}function me(t){if(!t.fn)return;we(t);const e=Te;Tt(t,t.value,e)}function Tt(t,e,n){let s;const a=O,i=B;B=O=t;try{s=t.fn(e)}catch(o){return t.pure&&(t.state=ie,t.owned&&t.owned.forEach(we),t.owned=null),t.updatedAt=n+1,nt(o)}finally{B=i,O=a}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?Ze(t,s):t.value=s,t.updatedAt=n)}function ze(t,e,n,s=ie,a){const i={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:O,context:O?O.context:null,pure:n};return O===null||O!==Je&&(O.owned?O.owned.push(i):O.owned=[i]),i}function Ee(t){if(t.state===0)return;if(t.state===De)return Ie(t);if(t.suspense&&ae(t.suspense.inFallback))return t.suspense.effects.push(t);const e=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<Te);)t.state&&e.push(t);for(let n=e.length-1;n>=0;n--)if(t=e[n],t.state===ie)me(t);else if(t.state===De){const s=j;j=null,xe(()=>Ie(t,e[0]),!1),j=s}}function xe(t,e){if(j)return t();let n=!1;e||(j=[]),ee?n=!0:ee=[],Te++;try{const s=t();return Ct(n),s}catch(s){n||(ee=null),j=null,nt(s)}}function Ct(t){if(j&&(et(j),j=null),t)return;const e=ee;ee=null,e.length&&xe(()=>Ge(e),!1)}function et(t){for(let e=0;e<t.length;e++)Ee(t[e])}function Et(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:Ee(s)}for(e=0;e<n;e++)Ee(t[e])}function Ie(t,e){t.state=0;for(let n=0;n<t.sources.length;n+=1){const s=t.sources[n];if(s.sources){const a=s.state;a===ie?s!==e&&(!s.updatedAt||s.updatedAt<Te)&&Ee(s):a===De&&Ie(s,e)}}}function tt(t){for(let e=0;e<t.observers.length;e+=1){const n=t.observers[e];n.state||(n.state=De,n.pure?j.push(n):ee.push(n),n.observers&&tt(n))}}function we(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),s=t.sourceSlots.pop(),a=n.observers;if(a&&a.length){const i=a.pop(),o=n.observerSlots.pop();s<a.length&&(i.sourceSlots[o]=s,a[s]=i,n.observerSlots[s]=o)}}if(t.tOwned){for(e=t.tOwned.length-1;e>=0;e--)we(t.tOwned[e]);delete t.tOwned}if(t.owned){for(e=t.owned.length-1;e>=0;e--)we(t.owned[e]);t.owned=null}if(t.cleanups){for(e=t.cleanups.length-1;e>=0;e--)t.cleanups[e]();t.cleanups=null}t.state=0}function It(t){return t instanceof Error?t:new Error(typeof t=="string"?t:"Unknown error",{cause:t})}function nt(t,e=O){throw It(t)}const Wt=Symbol("fallback");function st(t){for(let e=0;e<t.length;e++)t[e]()}function At(t,e,n={}){let s=[],a=[],i=[],o=0,r=e.length>1?[]:null;return Dt(()=>st(i)),()=>{let d=t()||[],f=d.length,u,c;return d[kt],ae(()=>{let b,m,k,y,S,D,I,N,z;if(f===0)o!==0&&(st(i),i=[],s=[],a=[],o=0,r&&(r=[])),n.fallback&&(s=[Wt],a[0]=Ce(K=>(i[0]=K,n.fallback())),o=1);else if(o===0){for(a=new Array(f),c=0;c<f;c++)s[c]=d[c],a[c]=Ce(l);o=f}else{for(k=new Array(f),y=new Array(f),r&&(S=new Array(f)),D=0,I=Math.min(o,f);D<I&&s[D]===d[D];D++);for(I=o-1,N=f-1;I>=D&&N>=D&&s[I]===d[N];I--,N--)k[N]=a[I],y[N]=i[I],r&&(S[N]=r[I]);for(b=new Map,m=new Array(N+1),c=N;c>=D;c--)z=d[c],u=b.get(z),m[c]=u===void 0?-1:u,b.set(z,c);for(u=D;u<=I;u++)z=s[u],c=b.get(z),c!==void 0&&c!==-1?(k[c]=a[u],y[c]=i[u],r&&(S[c]=r[u]),c=m[c],b.set(z,c)):i[u]();for(c=D;c<f;c++)c in k?(a[c]=k[c],i[c]=y[c],r&&(r[c]=S[c],r[c](c))):a[c]=Ce(l);a=a.slice(0,o=f),s=d.slice(0)}return a});function l(b){if(i[c]=b,r){const[m,k]=Y(c);return r[c]=k,e(d[c],m)}return e(d[c])}}}function U(t,e){return ae(()=>t(e||{}))}const Mt=t=>`Stale read from <${t}>.`;function de(t){const e="fallback"in t&&{fallback:()=>t.fallback};return H(At(()=>t.each,t.children,e||void 0))}function Nt(t){const e=t.keyed,n=H(()=>t.when,void 0,void 0),s=e?n:H(n,void 0,{equals:(a,i)=>!a==!i});return H(()=>{const a=s();if(a){const i=t.children;return typeof i=="function"&&i.length>0?ae(()=>i(e?a:()=>{if(!ae(s))throw Mt("Show");return n()})):i}return t.fallback},void 0,void 0)}const L=t=>H(()=>t());function Bt(t,e,n){let s=n.length,a=e.length,i=s,o=0,r=0,d=e[a-1].nextSibling,f=null;for(;o<a||r<i;){if(e[o]===n[r]){o++,r++;continue}for(;e[a-1]===n[i-1];)a--,i--;if(a===o){const u=i<s?r?n[r-1].nextSibling:n[i-r]:d;for(;r<i;)t.insertBefore(n[r++],u)}else if(i===r)for(;o<a;)(!f||!f.has(e[o]))&&e[o].remove(),o++;else if(e[o]===n[i-1]&&n[r]===e[a-1]){const u=e[--a].nextSibling;t.insertBefore(n[r++],e[o++].nextSibling),t.insertBefore(n[--i],u),e[a]=n[i]}else{if(!f){f=new Map;let c=r;for(;c<i;)f.set(n[c],c++)}const u=f.get(e[o]);if(u!=null)if(r<u&&u<i){let c=o,l=1,b;for(;++c<a&&c<i&&!((b=f.get(e[c]))==null||b!==u+l);)l++;if(l>u-r){const m=e[o];for(;r<u;)t.insertBefore(n[r++],m)}else t.replaceChild(n[r++],e[o++])}else o++;else e[o++].remove()}}}const rt="_$DX_DELEGATE";function Ot(t,e,n,s={}){let a;return Ce(i=>{a=i,e===document?t():v(e,t(),e.firstChild?null:void 0,n)},s.owner),()=>{a(),e.textContent=""}}function _(t,e,n,s){let a;const i=()=>{const r=s?document.createElementNS("http://www.w3.org/1998/Math/MathML","template"):document.createElement("template");return r.innerHTML=t,n?r.content.firstChild.firstChild:s?r.firstChild:r.content.firstChild},o=e?()=>ae(()=>document.importNode(a||(a=i()),!0)):()=>(a||(a=i())).cloneNode(!0);return o.cloneNode=o,o}function He(t,e=window.document){const n=e[rt]||(e[rt]=new Set);for(let s=0,a=t.length;s<a;s++){const i=t[s];n.has(i)||(n.add(i),e.addEventListener(i,Yt))}}function V(t,e,n){n==null?t.removeAttribute(e):t.setAttribute(e,n)}function it(t,e){e==null?t.removeAttribute("class"):t.className=e}function at(t,e,n){if(!e)return n?V(t,"style"):e;const s=t.style;if(typeof e=="string")return s.cssText=e;typeof n=="string"&&(s.cssText=n=void 0),n||(n={}),e||(e={});let a,i;for(i in n)e[i]==null&&s.removeProperty(i),delete n[i];for(i in e)a=e[i],a!==n[i]&&(s.setProperty(i,a),n[i]=a);return n}function We(t,e,n){n!=null?t.style.setProperty(e,n):t.style.removeProperty(e)}function v(t,e,n,s){if(n!==void 0&&!s&&(s=[]),typeof e!="function")return Ae(t,e,s,n);E(a=>Ae(t,e(),a,n),s)}function Yt(t){let e=t.target;const n=`$$${t.type}`,s=t.target,a=t.currentTarget,i=d=>Object.defineProperty(t,"target",{configurable:!0,value:d}),o=()=>{const d=e[n];if(d&&!e.disabled){const f=e[`${n}Data`];if(f!==void 0?d.call(e,f,t):d.call(e,t),t.cancelBubble)return}return e.host&&typeof e.host!="string"&&!e.host._$host&&e.contains(t.target)&&i(e.host),!0},r=()=>{for(;o()&&(e=e._$host||e.parentNode||e.host););};if(Object.defineProperty(t,"currentTarget",{configurable:!0,get(){return e||document}}),t.composedPath){const d=t.composedPath();i(d[0]);for(let f=0;f<d.length-2&&(e=d[f],!!o());f++){if(e._$host){e=e._$host,r();break}if(e.parentNode===a)break}}else r();i(s)}function Ae(t,e,n,s,a){for(;typeof n=="function";)n=n();if(e===n)return n;const i=typeof e,o=s!==void 0;if(t=o&&n[0]&&n[0].parentNode||t,i==="string"||i==="number"){if(i==="number"&&(e=e.toString(),e===n))return n;if(o){let r=n[0];r&&r.nodeType===3?r.data!==e&&(r.data=e):r=document.createTextNode(e),n=he(t,n,s,r)}else n!==""&&typeof n=="string"?n=t.firstChild.data=e:n=t.textContent=e}else if(e==null||i==="boolean")n=he(t,n,s);else{if(i==="function")return E(()=>{let r=e();for(;typeof r=="function";)r=r();n=Ae(t,r,n,s)}),()=>n;if(Array.isArray(e)){const r=[],d=n&&Array.isArray(n);if(Ve(r,e,n,a))return E(()=>n=Ae(t,r,n,s,!0)),()=>n;if(r.length===0){if(n=he(t,n,s),o)return n}else d?n.length===0?lt(t,r,s):Bt(t,n,r):(n&&he(t),lt(t,r));n=r}else if(e.nodeType){if(Array.isArray(n)){if(o)return n=he(t,n,s,e);he(t,n,null,e)}else n==null||n===""||!t.firstChild?t.appendChild(e):t.replaceChild(e,t.firstChild);n=e}}return n}function Ve(t,e,n,s){let a=!1;for(let i=0,o=e.length;i<o;i++){let r=e[i],d=n&&n[t.length],f;if(!(r==null||r===!0||r===!1))if((f=typeof r)=="object"&&r.nodeType)t.push(r);else if(Array.isArray(r))a=Ve(t,r,d)||a;else if(f==="function")if(s){for(;typeof r=="function";)r=r();a=Ve(t,Array.isArray(r)?r:[r],Array.isArray(d)?d:[d])||a}else t.push(r),a=!0;else{const u=String(r);d&&d.nodeType===3&&d.data===u?t.push(d):t.push(document.createTextNode(u))}}return a}function lt(t,e,n=null){for(let s=0,a=e.length;s<a;s++)t.insertBefore(e[s],n)}function he(t,e,n,s){if(n===void 0)return t.textContent="";const a=s||document.createTextNode("");if(e.length){let i=!1;for(let o=e.length-1;o>=0;o--){const r=e[o];if(a!==r){const d=r.parentNode===t;!i&&!o?d?t.replaceChild(a,r):t.insertBefore(a,n):d&&r.remove()}else i=!0}}else t.insertBefore(a,n);return[a]}var Lt=_('<div class=tag-detail><div style=display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:8px><button class=back-btn>← Back</button><button class=save-btn style=margin-left:auto>Save</button><button class=delete-btn>Delete</button></div><h2 class=tag-title></h2><div class=tag-form><label><span>ID</span><input type=text readonly></label><label><span>Name</span><input type=text></label><label><span>Start date</span><input type=date></label><label><span>End date</span><input type=date></label><label><span>Image</span><input type=text></label><label><span>Place</span><input type=text></label><label style="grid-column:1 / -1"><span>Description</span><textarea rows=6>'),Pt=_("<div class=tag-image-wrap><img class=tag-image>"),jt=_('<div class="tag-image-wrap placeholder">No image');function ot(t){const e=()=>t.tag||{},[n,s]=Y({id:e().id,name:e().name||"",startdate:t.prefill&&t.prefill.startdate||(e().startdate?new Date(e().startdate).toISOString().slice(0,10):""),enddate:t.prefill&&t.prefill.enddate||(e().enddate?new Date(e().enddate).toISOString().slice(0,10):""),background:e().background||"",description:e().description||"",place:e().place||""}),a=r=>{const d=r?new Date(r):null;return!d||isNaN(d.getTime())?null:d.toISOString().slice(0,10)},i=async()=>{const r=n(),d={id:r.id,name:r.name,startdate:a(r.startdate),enddate:a(r.enddate),background:r.background,description:r.description,place:r.place},u=await(await fetch("/api/tag/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).json();t.onSave(u),s({id:u.id,name:u.name||"",startdate:u.startdate?new Date(u.startdate).toISOString().slice(0,10):"",enddate:u.enddate?new Date(u.enddate).toISOString().slice(0,10):"",background:u.background||"",description:u.description||"",place:u.place||""})},o=async()=>{const r=n().id;if(!r||!confirm("Delete this tag? This cannot be undone."))return;(await fetch(`/api/tag/delete/${r}`,{method:"DELETE"})).ok&&t.onDelete(r)};return(()=>{var r=Lt(),d=r.firstChild,f=d.firstChild,u=f.nextSibling,c=u.nextSibling,l=d.nextSibling,b=l.nextSibling,m=b.firstChild,k=m.firstChild,y=k.nextSibling,S=m.nextSibling,D=S.firstChild,I=D.nextSibling,N=S.nextSibling,z=N.firstChild,K=z.nextSibling,be=N.nextSibling,ve=be.firstChild,q=ve.nextSibling,F=be.nextSibling,te=F.firstChild,le=te.nextSibling,ue=F.nextSibling,fe=ue.firstChild,Ne=fe.nextSibling,pe=ue.nextSibling,Be=pe.firstChild,Oe=Be.nextSibling;return f.$$click=()=>{try{t.onBack&&t.onBack(e().id)}catch{}history.length>1?history.back():window.location.hash=""},u.$$click=i,c.$$click=o,v(l,()=>{var M;return((M=e())==null?void 0:M.name)??"Tag"}),I.$$input=M=>s({...n(),name:M.currentTarget.value}),K.$$input=M=>s({...n(),startdate:M.currentTarget.value}),q.$$input=M=>s({...n(),enddate:M.currentTarget.value}),le.$$input=M=>s({...n(),background:M.currentTarget.value}),Ne.$$input=M=>s({...n(),place:M.currentTarget.value}),Oe.$$input=M=>s({...n(),description:M.currentTarget.value}),v(r,(()=>{var M=L(()=>{var ne;return!!((ne=e())!=null&&ne.background)});return()=>M()?(()=>{var ne=Pt(),Ye=ne.firstChild;return E(ge=>{var je;var Le=e().background,Pe=((je=e())==null?void 0:je.name)??"Tag image";return Le!==ge.e&&V(Ye,"src",ge.e=Le),Pe!==ge.t&&V(Ye,"alt",ge.t=Pe),ge},{e:void 0,t:void 0}),ne})():jt()})(),null),E(()=>y.value=n().id??""),E(()=>I.value=n().name),E(()=>K.value=n().startdate),E(()=>q.value=n().enddate),E(()=>le.value=n().background),E(()=>Ne.value=n().place),E(()=>Oe.value=n().description),r})()}He(["click","input"]);var Ft=_('<div class=tag-detail><div style=display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:8px><button class=back-btn>← Back</button><button class=save-btn style=margin-left:auto>Save</button><button class=delete-btn>Delete</button></div><h2 class=tag-title></h2><div class=tag-form><label><span>ID</span><input type=text readonly></label><label><span>Date</span><input type=date></label><label><span>Name</span><input type=text></label><label style="grid-column:1 / -1"><span>Description</span><textarea rows=6>');function ct(t){const e=()=>t.event||{},[n,s]=Y({id:e().id,date:t.prefill&&t.prefill.date||(e().date?new Date(e().date).toISOString().slice(0,10):""),name:e().name||"",description:e().description||""}),a=r=>{const d=r?new Date(r):null;return!d||isNaN(d.getTime())?null:d.toISOString().slice(0,10)},i=async()=>{const r=n(),d={id:r.id,date:a(r.date),name:r.name,description:r.description||""},u=await(await fetch("/api/event/save",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)})).json();t.onSave(u),s({id:u.id,date:u.date?new Date(u.date).toISOString().slice(0,10):"",name:u.name||"",description:u.description||""})},o=async()=>{const r=n().id;if(!r||!confirm("Delete this event? This cannot be undone."))return;(await fetch(`/api/event/delete/${r}`,{method:"DELETE"})).ok&&t.onDelete(r)};return(()=>{var r=Ft(),d=r.firstChild,f=d.firstChild,u=f.nextSibling,c=u.nextSibling,l=d.nextSibling,b=l.nextSibling,m=b.firstChild,k=m.firstChild,y=k.nextSibling,S=m.nextSibling,D=S.firstChild,I=D.nextSibling,N=S.nextSibling,z=N.firstChild,K=z.nextSibling,be=N.nextSibling,ve=be.firstChild,q=ve.nextSibling;return f.$$click=()=>{try{t.onBack&&t.onBack(e().id)}catch{}history.length>1?history.back():window.location.hash=""},u.$$click=i,c.$$click=o,v(l,(()=>{var F=L(()=>{var te;return!!((te=e())!=null&&te.name)});return()=>{var te;return F()?`Event: ${(te=e())==null?void 0:te.name}`:"Event"}})()),I.$$input=F=>s({...n(),date:F.currentTarget.value}),K.$$input=F=>s({...n(),name:F.currentTarget.value}),q.$$input=F=>s({...n(),description:F.currentTarget.value}),E(()=>y.value=n().id??""),E(()=>I.value=n().date),E(()=>K.value=n().name),E(()=>q.value=n().description||""),r})()}He(["click","input"]);var Ut=_("<div class=event-hover><div class=event-hover-title>Events (<!>)</div><ul class=event-hover-list>"),zt=_("<li tabindex=0>"),Ht=_("<a class=event-item-link><span class=event-date></span><span class=event-name>"),dt=_("<div class=event-desc>"),Vt=_("<div><span class=event-date></span><span class=event-name>"),Kt=_("<div class=event-more>and <!> more…");function Rt(t){const e=()=>t.events||[];return(()=>{var n=Ut(),s=n.firstChild,a=s.firstChild,i=a.nextSibling;i.nextSibling;var o=s.nextSibling;return v(s,()=>e().length,i),v(o,()=>e().slice(0,6).map(r=>(()=>{var d=zt();return v(d,(()=>{var f=L(()=>r.id!=null);return()=>f()?(()=>{var u=Ht(),c=u.firstChild,l=c.nextSibling;return v(c,()=>r.date),v(l,()=>r.name),v(u,(()=>{var b=L(()=>!!r.description);return()=>b()?(()=>{var m=dt();return v(m,()=>r.description),m})():null})(),null),E(()=>V(u,"href",`#events/${r.id}`)),u})():(()=>{var u=Vt(),c=u.firstChild,l=c.nextSibling;return v(c,()=>r.date),v(l,()=>r.name),v(u,(()=>{var b=L(()=>!!r.description);return()=>b()?(()=>{var m=dt();return v(m,()=>r.description),m})():null})(),null),u})()})()),d})())),v(n,(()=>{var r=L(()=>e().length>6);return()=>r()?(()=>{var d=Kt(),f=d.firstChild,u=f.nextSibling;return u.nextSibling,v(d,()=>e().length-6,u),d})():null})(),null),n})()}function qt(t,e){const n=new Date(t);return n.setDate(n.getDate()+e),n}function ut(...t){const e=[],n=s=>{if(s){if(typeof s=="string")e.push(s);else if(Array.isArray(s))s.forEach(n);else if(typeof s=="object")for(const a in s)Object.prototype.hasOwnProperty.call(s,a)&&s[a]&&e.push(a)}};return t.forEach(n),e.join(" ")}function ft(t){const e=new Date(t),n=e.getDay(),s=(n===0?-6:1)-n;return e.setDate(e.getDate()+s),e.setHours(0,0,0,0),e}function Gt(t){const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-n);const s=new Date(Date.UTC(e.getUTCFullYear(),0,1)),a=Math.ceil(((e.getTime()-s.getTime())/864e5+1)/7);return{isoYear:e.getUTCFullYear(),isoWeek:a}}function pt(t){const{isoYear:e,isoWeek:n}=Gt(t),s=n.toString().padStart(2,"0");return`${e}-${s}`}function Jt(t){const e={};for(const n of Object.keys(t)){const s=parseInt(n,10),a=t[s].sort((o,r)=>(r.length||0)-(o.length||0)),i=[];for(const o of a){let r=0;for(;r<i.length;){const d=i[r];let f=!1;for(const u of d)if(o.startWeek<u.endWeek&&o.endWeek>u.startWeek){f=!0;break}if(!f)break;r++}r===i.length&&i.push([]),i[r].push(o)}for(const o of i)o.sort((r,d)=>r.startWeek-d.startWeek);e[s]=i}return e}function Xt(t,e){const{startDate:n,baseYearLabel:s,years:a}=e,i={};for(const l of t)l&&l.id!=null&&(i[l.id]=l);const o=t.map(l=>{const b=l.startdate?new Date(l.startdate):null,m=l.enddate?new Date(l.enddate):null,k={};if(b){let y=ft(b);const S=m||b;for(;y<=S;)k[pt(y)]=!0,y=qt(y,7)}return{id:l.id??null,name:l.name??null,start:b,end:m,weekMap:k,startdate:l.startdate,enddate:l.enddate,place:l.place}}),r=[];for(let l=0;l<a;l++){const b=s+l,m=new Date(b,0,1);r.push({labelYear:b,firstDate:m,pad:0})}const d=Object.create(null);for(const l of r)d[l.labelYear]=l;function f(l){return 52}function u(l,b){const m=d[b];if(!m)return 1;const k=Math.floor((+l-+m.firstDate)/(1e3*60*60*24)),y=Math.floor(k/7)+1;return Math.max(1,Math.min(52,y))}const c={};for(const l of o){const b=l.start instanceof Date&&!isNaN(l.start.getTime()),m=l.end instanceof Date&&!isNaN(l.end.getTime());if(b&&l.start){const k=l.start,y=k.getFullYear(),S=u(k,y),D=m&&l.end&&l.end.getFullYear()===y?u(l.end,y):f();(c[y]=c[y]||[]).push({id:l.id,name:l.name,startWeek:S,endWeek:D,length:D-S+1,startdate:l.startdate,enddate:l.enddate,place:l.place})}if(m&&l.end){const k=l.end,y=k.getFullYear();if(!b||!l.start||y!==l.start.getFullYear()){const D=u(k,y);(c[y]=c[y]||[]).push({id:l.id,name:l.name,startWeek:1,endWeek:D,length:D-1+1,startdate:l.startdate,enddate:l.enddate,place:l.place})}}if(b&&m&&l.start&&l.end){const k=l.start.getFullYear(),y=l.end.getFullYear();if(y-k>=2)for(let S=k+1;S<=y-1;S++){const I=f();(c[S]=c[S]||[]).push({id:l.id,name:l.name,startWeek:1,endWeek:I,length:I-1+1,startdate:l.startdate,enddate:l.enddate,place:l.place})}}}return{yearMap:c,tagById:i,tagsList:t,yearSlotMap:Jt(c)}}function $e(t){const e={},n={};for(const s of t||[]){const a=s.date?new Date(s.date):null;if(!a||isNaN(a.getTime()))continue;const i=pt(ft(a));(e[i]=e[i]||[]).push(s),s.id!=null&&(n[s.id]=s)}return{eventsByWeek:e,eventById:n,eventsList:t||[]}}const Bn="";var Qt=_("<div class=tag-hover><div class=tag-hover-title></div><div class=tag-hover-dates><span></span><span> – </span><span>"),Zt=_("<div class=tag-hover-place>"),en=_("<div class=tag-hover-desc>"),tn=_("<div class=tag-hover-image><img>"),nn=_("<div class=tag-hover-posts>"),sn=_("<div class=tag-hover-loading>Loading posts…"),rn=_("<div class=tag-hover-error>Failed to load posts."),an=_("<div class=tag-hover-posts><div class=tag-hover-posts-title>Posts: </div><ul>"),ln=_("<li>"),on=_("<div class=tag-hover-more>and <!> more…"),cn=_("<div class=tag-hover-none>No posts"),dn=_("<div class=weeks-grid>"),un=_("<div class=decade-group><div class=decade-header></div><div class=weeks-header aria-hidden=true><div class=year-head-spacer>"),fn=_("<div class=week-head>"),pn=_("<div class=year-row><div class=year-head></div><div class=year-edge>"),gn=_("<div class=events-track><div class=year-head></div><div class=events-pins></div><div class=year-edge>"),hn=_("<div class=tag-bars><div class=year-head></div><div class=tag-lines></div><div class=tag-edge>"),bn=_("<div>"),vn=_("<div class=event-pin><span class=stem></span><span class=elabel>"),mn=_("<div class=tag-row>"),xn=_("<div><span class=tag-label> "),wn=_('<div class=week-event-tooltip><button class=week-event-tooltip-close aria-label="Close tooltip"title=Close style=position:absolute;top:4px;right:6px;background:transparent;border:none;color:#333;cursor:pointer;font-size:16px;line-height:1;padding:2px>×');function $n(t,e){const n=new Date(t);return n.setDate(n.getDate()+e),n}function yn(t){return t.toISOString().slice(0,10)}function kn(t){const e=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())),n=e.getUTCDay()||7;e.setUTCDate(e.getUTCDate()+4-n);const s=new Date(Date.UTC(e.getUTCFullYear(),0,1)),a=Math.ceil(((e.getTime()-s.getTime())/864e5+1)/7);return{isoYear:e.getUTCFullYear(),isoWeek:a}}function gt(t){const{isoYear:e,isoWeek:n}=kn(t),s=n.toString().padStart(2,"0");return`${e}-${s}`}function ht(t){const e=new Date(t),n=e.getDay(),s=(n===0?-6:1)-n;return e.setDate(e.getDate()+s),e.setHours(0,0,0,0),e}function Sn(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return Math.abs(e)}function _n(t){const e=t%360,n=`hsla(${e} 60% 86% / 0.45)`,s=`hsla(${e} 50% 50% / 0.7)`;return{bg:n,border:s}}function Dn(t){const e=(t.id!=null?String(t.id):"")+"|"+(t.name!=null?String(t.name):"");return _n(Sn(e))}function Me(t){const e=t.replace("#",""),n=parseInt(e.length===3?e.split("").map(s=>s+s).join(""):e,16);return{r:n>>16&255,g:n>>8&255,b:n&255}}function ye(t,e,n){return{r:Math.round(t.r+(e.r-t.r)*n),g:Math.round(t.g+(e.g-t.g)*n),b:Math.round(t.b+(e.b-t.b)*n)}}function bt(t,e){return`rgba(${t.r}, ${t.g}, ${t.b}, ${e})`}function vt(t,e,n){const s=Math.min(90,n),a=Math.max(0,Math.min(s-1,t-e)),i=s/4,o=Math.min(3,Math.floor(a/i)),r=Math.min(1,Math.max(0,(a-o*i)/Math.max(1,i-1))),d=Me("#86efac"),f=Me("#fbbf24"),u=Me("#ef4444"),c=Me("#9ca3af");let l,b;o===0?(l=d,b=ye(d,f,.5)):o===1?(l=f,b=ye(f,u,.5)):o===2?(l=u,b=ye(u,c,.5)):(l=c,b=ye(c,d,.5));const m=.1,k=.12,y=bt(l,m),S=bt(ye(l,b,r),k);return`linear-gradient(90deg, ${y} 0%, ${S} 100%)`}function Tn(t){const e=t.tag||{},n=e.startdate?new Date(e.startdate):null,s=e.enddate?new Date(e.enddate):null,a=i=>{if(!i)return"";const o=i instanceof Date?i:new Date(i);return isNaN(o.getTime())?"":o.toISOString().slice(0,10)};return(()=>{var i=Qt(),o=i.firstChild,r=o.nextSibling,d=r.firstChild,f=d.nextSibling,u=f.nextSibling;return v(o,()=>e.name||""),v(d,()=>a(n)),v(u,()=>a(s)),v(i,(()=>{var c=L(()=>!!e.place);return()=>c()?(()=>{var l=Zt();return v(l,()=>e.place),l})():null})(),null),v(i,(()=>{var c=L(()=>!!e.description);return()=>c()?(()=>{var l=en();return v(l,()=>e.description),l})():null})(),null),v(i,(()=>{var c=L(()=>!!e.background);return()=>c()?(()=>{var l=tn(),b=l.firstChild;return E(m=>{var k=e.background,y=e.name||"tag image";return k!==m.e&&V(b,"src",m.e=k),y!==m.t&&V(b,"alt",m.t=y),m},{e:void 0,t:void 0}),l})():null})(),null),v(i,(()=>{var c=L(()=>!!e.postsStatus);return()=>c()?(()=>{var l=nn();return v(l,(()=>{var b=L(()=>e.postsStatus==="loading");return()=>b()?sn():L(()=>e.postsStatus==="error")()?rn():L(()=>!!(e.posts&&e.posts.length>0))()?(()=>{var m=an(),k=m.firstChild;k.firstChild;var y=k.nextSibling;return v(k,()=>e.posts.length,null),v(y,()=>e.posts.slice(0,15).map(S=>(()=>{var D=ln();return v(D,()=>S.title||`Post #${S.id}`),D})())),v(m,(()=>{var S=L(()=>e.posts.length>15);return()=>S()?(()=>{var D=on(),I=D.firstChild,N=I.nextSibling;return N.nextSibling,v(D,()=>e.posts.length-15,N),D})():null})(),null),m})():cn()})()),l})():null})(),null),i})()}function Cn(){const t=new Date("1987-05-10"),e=100,n=1987,[s,a]=Y({}),[i,o]=Y({}),[r,d]=Y([]),[f,u]=Y({}),[c,l]=Y({}),[b,m]=Y(typeof window<"u"?window.location.hash:""),[k,y]=Y(null),S=H(()=>{const $=(b()||"").match(/^#tags\/(\d+)/);return $?parseInt($[1],10):null}),D=H(()=>/^#tags\/new$/.test(b()||"")),I=H(()=>{const $=(b()||"").match(/^#events\/(\d+)/);return $?parseInt($[1],10):null}),N=H(()=>/^#events\/new$/.test(b()||"")),[z,K]=Y(null),[be,ve]=Y(null),[q,F]=Y({}),[te,le]=Y({}),[ue,fe]=Y([]),[Ne,pe]=Y(null),[Be,Oe]=Y(null),[M,ne]=Y({x:0,y:0,visible:!1}),[Ye,ge]=Y(null),Le=H(()=>{const h=[];for(let $=0;$<e;$++){const g=n+$,w=new Date(g,0,1),p=[];for(let x=0;x<52;x++){const W=$n(w,x*7),J=W.toLocaleString(void 0,{month:"short"}),se=W.toISOString().slice(0,10);p.push({title:`${J} • W${x+1} • ${se}`,start:W})}h.push({labelYear:g,firstDate:w,pad:0,weeks:p})}return h}),Pe=H(()=>{const h=Le(),$=[];for(let g=0,w=0;g<h.length;g+=10,w++){const p=h.slice(g,g+10);if(p.length===0)continue;let x;w===0?x="First 10 years":w===1?x="my teens":x=`my ${w}0s`,$.push({label:x,years:p})}return $}),je=H(()=>Array.from({length:52},(h,$)=>$+1));async function En(h){if(h==null)return;const $=f();if(!$[h]){u({...$,[h]:{status:"loading",posts:[]}}),o(g=>({...g,[h]:{...g[h],posts:[],postsStatus:"loading"}}));try{const g=await fetch(`/api/tag/posts/${h}`);if(!g.ok)throw new Error("Bad response");const w=await g.json();u(p=>({...p,[h]:{status:"loaded",posts:w}})),o(p=>({...p,[h]:{...p[h],posts:w,postsStatus:"loaded"}}))}catch{u(w=>({...w,[h]:{status:"error",posts:[]}})),o(w=>({...w,[h]:{...w[h],posts:[],postsStatus:"error"}}))}}}function ke(h){const{yearMap:$,tagById:g,tagsList:w,yearSlotMap:p}=Xt(h,{startDate:t,baseYearLabel:n,years:e});o(g),d(w),a($),l(p);try{console.log("Years:",p)}catch{}}return _t(()=>{window.addEventListener("hashchange",()=>m(window.location.hash)),fetch("/api/tags").then(h=>h.json()).then(h=>{ke(h)}).catch(h=>console.error(h)),fetch("/api/events").then(h=>h.json()).then(h=>{const $=$e(h||[]);console.log("events by week:",$.eventsByWeek),F($.eventsByWeek),le($.eventById),fe($.eventsList)}).catch(h=>console.error(h))}),Xe(()=>{S()==null&&!D()&&k()!=null&&setTimeout(()=>{const $=document.querySelector(".tag-span.edited");if($&&typeof $.scrollIntoView=="function")try{$.scrollIntoView({block:"center",inline:"nearest",behavior:"smooth"})}catch{$.scrollIntoView(!0)}},0)}),[L(()=>L(()=>!!(S()!=null||D()))()?(()=>{if(D()){const g=be();return U(ot,{tag:{},onSave:w=>{o(x=>({...x,[w.id]:w}));const p=[...r().filter(x=>x.id!==w.id),w];ke(p),K(null),ve(null),y(w.id),window.location.hash=""},onDelete:w=>{o(x=>{const{[w]:W,...J}=x;return J});const p=r().filter(x=>x.id!==w);ke(p),window.location.hash=""},prefill:g||{startdate:"",enddate:""}})}const h=S(),$=i()[h];return U(ot,{tag:$,onSave:g=>{o(p=>({...p,[g.id]:g}));const w=[...r().filter(p=>p.id!==g.id),g];ke(w),y(g.id),window.location.hash=""},onDelete:g=>{o(p=>{const{[g]:x,...W}=p;return W});const w=r().filter(p=>p.id!==g);ke(w),window.location.hash=""},onBack:g=>{g!=null&&y(g)}})})():L(()=>!!(I()!=null||N()))()?(()=>{if(N())return U(ct,{event:null,onSave:g=>{const w=[...ue().filter(x=>x.id!==g.id),g],p=$e(w);F(p.eventsByWeek),le(p.eventById),fe(p.eventsList),pe(null),window.location.hash=""},onDelete:g=>{const w=ue().filter(x=>x.id!==g),p=$e(w);F(p.eventsByWeek),le(p.eventById),fe(p.eventsList),pe(null),window.location.hash=""},get prefill(){return Ne()||void 0}});const h=I(),$=te()[h];return U(ct,{event:$,onSave:g=>{const w=[...ue().filter(x=>x.id!==g.id),g],p=$e(w);F(p.eventsByWeek),le(p.eventById),fe(p.eventsList),pe(null),window.location.hash=""},onDelete:g=>{const w=ue().filter(x=>x.id!==g),p=$e(w);F(p.eventsByWeek),le(p.eventById),fe(p.eventsList),pe(null),window.location.hash=""}})})():(()=>{var h=dn();return v(h,U(de,{get each(){return Pe()},children:$=>(()=>{var g=un(),w=g.firstChild,p=w.nextSibling;return p.firstChild,v(w,()=>$.label),v(p,U(de,{get each(){return je()},children:x=>(()=>{var W=fn();return V(W,"title",`Week ${x}`),v(W,x),W})()}),null),v(g,U(de,{get each(){return $.years},children:x=>[(()=>{var W=pn(),J=W.firstChild,se=J.nextSibling;return v(J,()=>x.labelYear),v(W,U(de,{get each(){return x.weeks},children:A=>{const re=()=>z()&&A.start&&z().getTime()===A.start.getTime(),X=(()=>{const C=A.start.getMonth();return C===11||C===0||C===1?"winter":C>=2&&C<=4?"spring":C>=5&&C<=7?"summer":"autumn"})(),T=gt(ht(A.start)),Q=()=>(q()[T]||[]).length>0,R=()=>{const C=z();if(!C)K(new Date(A.start));else if(C.getTime()===A.start.getTime())K(null);else{const P=C<A.start?C:A.start,Z=C<A.start?A.start:C;ve({startdate:P.toISOString().slice(0,10),enddate:Z.toISOString().slice(0,10)}),K(null),window.location.hash="#tags/new"}},Se=()=>{pe({date:A.start.toISOString().slice(0,10)}),window.location.hash="#events/new"};return(()=>{var C=bn();return C.addEventListener("mouseenter",P=>{if(!Q()||M().visible&&Ye()===T)return;ge(T);const Z=q()[T]||[];Be()!==Z&&Oe(Z);const oe=Math.min(P.clientX-12,(window.innerWidth||1024)-260),Fe=Math.min(P.clientY-12,(window.innerHeight||768)-200);(!M()||M().visible===!1||M().x!==oe||M().y!==Fe)&&ne({x:oe,y:Fe,visible:!0})}),C.$$dblclick=Se,C.$$click=R,E(P=>{var Z=ut("week-box",`season-${X}`,{selected:re(),filled:Q(),"before-my-time":A.start.getTime()<new Date("1987-05-10").getTime(),future:A.start.getTime()>new Date().getTime()}),oe=A.title;return Z!==P.e&&it(C,P.e=Z),oe!==P.t&&V(C,"title",P.t=oe),P},{e:void 0,t:void 0}),C})()}}),se),E(A=>{var re=`Year ${x.labelYear} — starting ${yn(x.firstDate)}`,X=vt(x.labelYear,n,e);return re!==A.e&&V(W,"aria-label",A.e=re),X!==A.t&&We(se,"background",A.t=X),A},{e:void 0,t:void 0}),W})(),(()=>{var W=gn(),J=W.firstChild,se=J.nextSibling;return v(se,U(Nt,{get when(){return Object.keys(q()).length>0},get children(){return U(de,{get each(){return x.weeks},children:(A,re)=>{const X=gt(ht(A.start)),T=q()[X]||[];if(console.log(T,X,q()),!T||T.length===0)return null;let Q=T.map(R=>R==null?void 0:R.name).filter(Boolean).join(", ");return Q||(Q=`${T.length} event${T.length>1?"s":""}`),(()=>{var R=vn(),Se=R.firstChild,C=Se.nextSibling;return V(C,"title",Q),v(C,Q),E(P=>at(R,`--x: ${re()+1};`,P)),R})()}})}})),W})(),(()=>{var W=hn(),J=W.firstChild,se=J.nextSibling,A=se.nextSibling;return v(se,U(de,{get each(){return c()[x.labelYear]||[]},children:re=>(()=>{var X=mn();return v(X,U(de,{each:re,children:T=>{const Q=Dn(T),R=x.pad+T.startWeek,Se=x.pad+T.endWeek,C=()=>{T.id!=null&&(window.location.hash=`#tags/${T.id}`)},P=new Date(x.labelYear,0,1).getTime(),Z=new Date(x.labelYear+1,0,1).getTime(),oe=T.startdate?new Date(T.startdate).getTime():P,Fe=T.enddate?new Date(T.enddate).getTime():oe,Ke=Math.max(P,oe),In=Math.min(Z,Fe),mt=Math.max(1,Z-P),Wn=Math.max(0,(Ke-P)/mt*100),An=Math.max(.5,(Math.max(In,Ke)-Ke)/mt*100);return(()=>{var ce=xn(),Re=ce.firstChild,Mn=Re.firstChild;return ce.addEventListener("mouseenter",()=>En(T.id)),ce.$$click=C,v(Re,(()=>{var G=L(()=>!!T.place);return()=>G()?T.place+" - ":""})(),Mn),v(Re,()=>T.name,null),v(ce,()=>{const G=i()[T.id]||{};return U(Tn,{tag:G})},null),E(G=>{var xt=ut("tag-span",{edited:k()===T.id}),Nn=`--x: ${R-1}; --w: ${Se-R+1}; --left: ${Wn}%; --width: ${An}%; background:${Q.bg}; border-color:${Q.border}; cursor:pointer;`,wt=`${T.name} (W${T.startWeek}–W${T.endWeek})`;return xt!==G.e&&it(ce,G.e=xt),G.t=at(ce,Nn,G.t),wt!==G.a&&V(ce,"title",G.a=wt),G},{e:void 0,t:void 0,a:void 0}),ce})()}})),X})()})),E(re=>We(A,"background",vt(x.labelYear,n,e))),W})()]}),null),E(()=>V(g,"aria-label",$.label)),g})()})),h})()),L(()=>{const h=M(),$=Be();return h.visible&&$&&$.length>0?(()=>{var g=wn(),w=g.firstChild;return g.$$click=()=>ne({x:h.x,y:h.y,visible:!1}),g.$$pointerdown=p=>{p.stopPropagation()},w.$$click=p=>{p.stopPropagation(),ne({x:h.x,y:h.y,visible:!1})},v(g,U(Rt,{events:$}),null),E(p=>{var x=`${h.x}px`,W=`${h.y}px`;return x!==p.e&&We(g,"left",p.e=x),W!==p.t&&We(g,"top",p.t=W),p},{e:void 0,t:void 0}),g})():null})]}document.addEventListener("DOMContentLoaded",()=>{const t=document.getElementById("weeks");t&&Ot(()=>U(Cn,{}),t)}),He(["click","dblclick","pointerdown"])})();
//# sourceMappingURL=weeks.js.map
